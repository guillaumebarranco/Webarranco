window.onload = function() {

	document.body.style.zoom = screen.width/1800;
	var canvas = document.getElementById("canvas");
	canvas.zoom
 	var ctx = canvas.getContext("2d");
	var line_x = 760;
	var line_y = 940;

	ctx.beginPath();//On démarre un nouveau tracé
	ctx.moveTo(line_x, line_y);

	line_y = line_y - 30;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 200;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 270;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 250;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 200;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 30;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 180;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 250;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 350;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 90;
	ctx.lineTo(line_x, line_y);

	// Sortie de la zone verte
	//console.log(line_x);
	//console.log(line_y);

	line_y = line_y - 80;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 350;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 250;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 550;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 20;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 200;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 100;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 200;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 300;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 450;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 300;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 150;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 20;
	ctx.lineTo(line_x, line_y);

	// On vient de terminer l'arène finale
	// console.log(line_x);
	// console.log(line_y);

	line_x = line_x + 180;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 100;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 50;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 250;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 300;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 50;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 250;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 250;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 100;
	ctx.lineTo(line_x, line_y);

	// console.log(line_x);
	// console.log(line_y);

	// On vient de terminer l'arène rouge

	line_y = line_y + 200;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 150;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 100;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 80;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 50;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 170;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 250;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 300;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 20;
	ctx.lineTo(line_x, line_y);

	

	// On vient de terminer l'arène n°3

	line_x = line_x - 380;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 350;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 610;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 250;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 200;
	ctx.lineTo(line_x, line_y);


	line_y = line_y + 50;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 100;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 50;
	ctx.lineTo(line_x, line_y);

	// On vient de totalement finir la zone n°1

	line_x = line_x + 70;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 210;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 250;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 250;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 160;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 100;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 100;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 100;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 30;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 80;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 100;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 100;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 15;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 20;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 215;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 80;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 100;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 200;
	ctx.lineTo(line_x, line_y);


	ctx.strokeStyle = "white";//On trace seulement les lignes.
	ctx.stroke();//On trace seulement les lignes.
	ctx.closePath();


	line_y = 500;
	line_x = 1100;

	ctx.beginPath();//On démarre un nouveau tracé
	ctx.moveTo(line_x, line_y);

	line_x = line_x + 120;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 230;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 230;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 120;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 70;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 140;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 130;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 220;
	ctx.lineTo(line_x, line_y);

	line_x = line_x + 150;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 10;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 120;
	ctx.lineTo(line_x, line_y);

	line_y = line_y + 50;
	ctx.lineTo(line_x, line_y);

	line_x = line_x - 320;
	ctx.lineTo(line_x, line_y);

	line_y = line_y - 310;
	ctx.lineTo(line_x, line_y);

	ctx.strokeStyle = "white";//On trace seulement les lignes.
	ctx.stroke();//On trace seulement les lignes.
	ctx.closePath();


	// PORTES

	// Porte Verte

	ctx.beginPath();//On démarre un nouveau tracé
	line_y = 270;
	line_x = 120;
	ctx.moveTo(line_x, line_y);

	line_x = line_x + 90;
	ctx.lineTo(line_x, line_y);

	ctx.strokeStyle = "green";//On trace seulement les lignes.
	ctx.stroke();//On trace seulement les lignes.
	ctx.closePath();

	// Porte Rouge

	ctx.beginPath();//On démarre un nouveau tracé
	line_y = 390;
	line_x = 1600;
	ctx.moveTo(line_x, line_y);

	line_x = line_x - 80;
	ctx.lineTo(line_x, line_y);

	ctx.strokeStyle = "red";//On trace seulement les lignes.
	ctx.stroke();//On trace seulement les lignes.
	ctx.closePath();

	// Porte Bleue

	ctx.beginPath();//On démarre un nouveau tracé
	line_y = 870;
	line_x = 1400;
	ctx.moveTo(line_x, line_y);

	line_y = line_y - 60;
	ctx.lineTo(line_x, line_y);

	ctx.strokeStyle = "blue";//On trace seulement les lignes.
	ctx.stroke();//On trace seulement les lignes.
	ctx.closePath();

	// Porte Jaune Finale

	ctx.beginPath();//On démarre un nouveau tracé
	line_y = 320;
	line_x = 920;
	ctx.moveTo(line_x, line_y);

	line_x = line_x - 100;
	ctx.lineTo(line_x, line_y);
	line_x = line_x + 100;
	line_y = line_y + 1;
	ctx.lineTo(line_x, line_y);
	line_x = line_x - 100;
	line_y = line_y + 1;
	ctx.lineTo(line_x, line_y);
	line_x = line_x + 100;
	ctx.lineTo(line_x, line_y);
	line_x = line_x - 100;
	line_y = line_y + 1;
	ctx.lineTo(line_x, line_y);
	line_x = line_x + 100;
	line_y = line_y + 1;
	ctx.lineTo(line_x, line_y);

	ctx.strokeStyle = "yellow";//On trace seulement les lignes.
	ctx.stroke();//On trace seulement les lignes.
	ctx.closePath();

	//////////

	// TRACAGE PROTECTION DE L'EMERAUDE KOKIRI

	ctx.beginPath();//On démarre un nouveau tracé
	line_y = 620;
	line_x = 100;
	ctx.moveTo(line_x, line_y);

	line_y = line_y - 160;
	ctx.lineTo(line_x, line_y);

	ctx.strokeStyle = "white";//On trace seulement les lignes.
	ctx.stroke();//On trace seulement les lignes.
	ctx.closePath();

	ctx.beginPath();//On démarre un nouveau tracé
	line_y = 400;
	line_x = 30;
	ctx.moveTo(line_x, line_y);

	line_x = line_x + 140;
	ctx.lineTo(line_x, line_y);
	line_y = line_y + 140;
	ctx.lineTo(line_x, line_y);

	ctx.strokeStyle = "white";//On trace seulement les lignes.
	ctx.stroke();//On trace seulement les lignes.
	ctx.closePath();

	ctx.beginPath();//On démarre un nouveau tracé
	line_y = 620;
	ctx.moveTo(line_x, line_y);

	line_y = line_y - 30;
	ctx.lineTo(line_x, line_y);

	ctx.strokeStyle = "white";//On trace seulement les lignes.
	ctx.stroke();//On trace seulement les lignes.
	ctx.closePath();

	// FIN DU TRACAGE

	// TRACAGE DE PROTECTION DU RUBIS GORON

	ctx.beginPath();//On démarre un nouveau tracé
	line_y = 140;
	line_x = 1610;
	ctx.moveTo(line_x, line_y);

	line_y = line_y + 180;
	ctx.lineTo(line_x, line_y);
	line_x = line_x + 30;
	ctx.lineTo(line_x, line_y);

	ctx.strokeStyle = "white";//On trace seulement les lignes.
	ctx.stroke();//On trace seulement les lignes.
	ctx.closePath();

	// FIN DU TRACAGE

	// TRACAGE DE PROTECTION DU SAPHIR ZORA

	ctx.beginPath();//On démarre un nouveau tracé
	line_y = 830;
	line_x = 1700;
	ctx.moveTo(line_x, line_y);

	line_x = line_x - 180;
	ctx.lineTo(line_x, line_y);

	ctx.strokeStyle = "white";//On trace seulement les lignes.
	ctx.stroke();//On trace seulement les lignes.
	ctx.closePath();

	var x= 800;
	var y = 900;

	var has_sword = 0;

	var link = new Image();
			link.src = '/Webarranco/img/zelda/sprite.png';

			var sword = new Image();
			sword.src = '/Webarranco/img/zelda/sword.png';

			var joyaux = new Image();
			joyaux.src = '/Webarranco/img/zelda/sprite_joyaux.png';
			var triforce = new Image();
			triforce.src = '/Webarranco/img/zelda/triforce.png';

			var black = new Image();
			black.src = '/Webarranco/img/zelda/black.png';
			var black2 = new Image();
			black2.src = '/Webarranco/img/zelda/black2.png';
			var black3 = new Image();
			black3.src = '/Webarranco/img/zelda/black3.png';
			

			link.onload = function(){
				ctx.drawImage(link, 0, 0, 20, 26, x, y, 20, 26);
			};

			sword.onload = function(){
				ctx.drawImage(sword, 0, 0, 20, 26, 700, 580, 20, 26);
			};

			triforce.onload = function(){
				ctx.drawImage(triforce, 0, 0, 282, 143, 710, 50, 282, 143);
			};

			joyaux.onload = function(){
				ctx.drawImage(joyaux, 0, 0, 21, 27, 50, 580, 21, 27);
				ctx.drawImage(joyaux, 21, 0, 21, 27, 1660, 160, 21, 27);
				ctx.drawImage(joyaux, 42, 0, 29, 27, 1650, 850, 29, 27);
			};


	// FIN DU TRACAGE

	window.onkeydown = function(event) {

		var h2 = document.getElementById('msg');

		var $pos_top = $('#canvas').offset().top;
		//console.log($pos_top);

		var e = event || window.event;
		var key = e.which || e.keyCode;

		// Gestion de la récupération de l'épée
		if(y == 580 && x > 680 && x < 720) {
			has_sword = 1;
			link.src = '/Webarranco/img/zelda/sprite_sword.png';
		}

		// Gestion entrée zone bleue
		if(y < 440 && y > 370 && x < 310 && x > 280) {
			console.log('Vous venez d\'entrer dans la zone bleue');
		}

		// Triforce
		if(y < 280 && y > 30 && x < 1000 && x > 610) {
			h2.style.top = ($pos_top+50)+'px';
			h2.style.left = '630px';
			h2.innerHTML = 'Vous avez récupéré la Triforce';
			setTimeout(function(){
				window.location = '/Webarranco/';
			}, 1500);
			
		}

		// Emeraude Kokiri
		if(y > 560 && y < 590 && x > 30 && x < 60) {
			h2.style.top = ($pos_top+600)+'px';
			h2.style.left = '70px';
			h2.innerHTML = 'Vous avez récupéré l\'Emeraude Kokiri';

			setTimeout(function(){h2.innerHTML = ''}, 3000);

			ctx.beginPath();//On démarre un nouveau tracé
			line_y = 270;
			line_x = 120;
			ctx.moveTo(line_x, line_y);

			line_x = line_x + 90;
			ctx.lineTo(line_x, line_y);
			line_x = line_x - 100;
			line_y = line_y + 1;
			ctx.lineTo(line_x, line_y);
			line_x = line_x + 100;
			line_y = line_y - 2;
			ctx.lineTo(line_x, line_y);

			ctx.strokeStyle = "black";//On trace seulement les lignes.
			ctx.stroke();//On trace seulement les lignes.
			ctx.closePath();
		}

		// Rubis Goron
		if(y > 150 && y < 180 && x > 1630 && x < 1670) {
			h2.style.top = ($pos_top+200)+'px';
			h2.style.left = '1500px';
			h2.innerHTML = 'Vous avez récupéré le Rubis Goron';

			setTimeout(function(){h2.innerHTML = ''}, 3000);
			
			ctx.beginPath();//On démarre un nouveau tracé

			line_y = 390;
			line_x = 1600;
			ctx.moveTo(line_x, line_y);

			line_x = line_x - 80;
			ctx.lineTo(line_x, line_y);

			line_x = line_x + 80;
			line_y = line_y + 1;
			ctx.lineTo(line_x, line_y);
			line_x = line_x - 80;
			line_y = line_y - 2;
			ctx.lineTo(line_x, line_y);

			ctx.strokeStyle = "black";//On trace seulement les lignes.
			ctx.stroke();//On trace seulement les lignes.
			ctx.closePath();
		}

		// Saphir Zora
		if(y > 830 && y < 870 && x > 1620 && x < 1660) {
			console.log('Vous avez récupéré le Saphir Zora');
			console.log('Vous avez récupéré le Rubis Goron');
			h2.style.top = ($pos_top+780)+'px';
			h2.style.left = '1500px';
			h2.innerHTML = 'Vous avez récupéré le Saphir Zora';

			setTimeout(function(){h2.innerHTML = ''}, 3000);

			ctx.beginPath();//On démarre un nouveau tracé

			line_y = 870;
			line_x = 1400;
			ctx.moveTo(line_x, line_y);

			line_y = line_y - 60;
			ctx.lineTo(line_x, line_y);
			line_y = line_y + 60;
			line_x = line_x + 1;
			ctx.lineTo(line_x, line_y);
			line_y = line_y - 60;
			line_x = line_x - 2;
			ctx.lineTo(line_x, line_y);

			ctx.strokeStyle = "black";//On trace seulement les lignes.
			ctx.stroke();//On trace seulement les lignes.
			ctx.closePath();

			ctx.beginPath();//On démarre un nouveau tracé
			line_y = 320;
			line_x = 920;
			ctx.moveTo(line_x, line_y);

			line_x = line_x - 100;
			ctx.lineTo(line_x, line_y);
			line_x = line_x + 100;
			line_y = line_y + 1;
			ctx.lineTo(line_x, line_y);
			line_x = line_x - 100;
			line_y = line_y + 1;
			ctx.lineTo(line_x, line_y);
			line_x = line_x + 100;
			ctx.lineTo(line_x, line_y);
			line_x = line_x - 100;
			line_y = line_y + 1;
			ctx.lineTo(line_x, line_y);
			line_x = line_x + 100;
			line_y = line_y + 1;
			ctx.lineTo(line_x, line_y);

			ctx.strokeStyle = "black";//On trace seulement les lignes.
			ctx.stroke();//On trace seulement les lignes.
			ctx.closePath();
		}

	    switch(key) {
			case 38 : case 122 : case 119 : case 90 : case 87 : // Flèche haut, z, w, Z, W
				event.preventDefault();
				//joueur.deplacer(DIRECTION.HAUT, map);
				

				if(has_sword == 0) {
					y = y - 20;
					ctx.drawImage(black, 0, 0, 20, 26, x, y+20, 20, 26);
					ctx.drawImage(link, 0, 0, 20, 26, x, y, 20, 26);
				} else {
					y = y - 25;
					ctx.drawImage(black3, 0, 0, 40, 47, x, y+40, 40, 47);
					ctx.drawImage(link, 0, 0, 25, 47, x, y, 25, 47);
				}
				
				break;
			case 40 : case 115 : case 83 : // Flèche bas, s, S
				event.preventDefault();
				if(has_sword == 0) {
					y = y + 20;
					ctx.drawImage(black, 0, 0, 20, 26, x, y-20, 20, 26);
					ctx.drawImage(link, 20, 0, 20, 26, x, y, 20, 26);
				} else {
					y = y + 25;
					ctx.drawImage(black3, 0, 0, 40, 47, x, y-40, 40, 47);
					ctx.drawImage(link, 25, 0, 25, 47, x, y, 25, 47);
				}
				
				//joueur.deplacer(DIRECTION.BAS, map);
				break;
			case 37 : case 113 : case 97 : case 81 : case 65 : // Flèche gauche, q, a, Q, A
				event.preventDefault();
				//joueur.deplacer(DIRECTION.GAUCHE, map);
				if(has_sword == 0) {
					x = x - 26;
					ctx.drawImage(black, 0, 0, 20, 26, x+26, y, 20, 26);
					ctx.drawImage(link, 40, 0, 20, 26, x, y, 20, 26);
				} else {
					x = x - 20; // Anciennement 47
					ctx.drawImage(black3, 0, 0, 40, 47, x+20, y, 40, 47);
					ctx.drawImage(link, 50, 0, 40, 47, x, y, 40, 47);
				}
				
				break;
			case 39 : case 100 : case 68 : // Flèche droite, d, D
				event.preventDefault();
				//joueur.deplacer(DIRECTION.DROITE, map);
				if(has_sword == 0) {
					x = x + 26;
					ctx.drawImage(black, 0, 0, 20, 26, x-26, y, 20, 26);
					ctx.drawImage(link, 60, 0, 20, 26, x, y, 20, 26);
				} else {
					x = x + 20;
					ctx.drawImage(black3, 0, 0, 40, 47, x-20, y, 40, 47);
					ctx.drawImage(link, 90, 0, 40, 47, x, y, 40, 47);
				}
				
				break;
			default : 
				//alert(key);
				// Si la touche ne nous sert pas, nous n'avons aucune raison de bloquer son comportement normal.
				return true;
		}
	}
}